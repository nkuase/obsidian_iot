/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var ne=(e,n)=>{for(var t in n)I(e,t,{get:n[t],enumerable:!0})},ie=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of te(n))!re.call(e,i)&&i!==t&&I(e,i,{get:()=>n[i],enumerable:!(r=ee(n,i))||r.enumerable});return e};var oe=e=>ie(I({},"__esModule",{value:!0}),e);var he={};ne(he,{default:()=>P});module.exports=oe(he);var w=require("obsidian");var $=require("obsidian");var T="is-resolved",_="is-unresolved";function se(e,n){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=ae(e))||n&&e&&typeof e.length=="number"){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ae(e,n){if(e){if(typeof e=="string")return B(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return B(e,n)}}function B(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function U(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,n,t){return n&&U(e.prototype,n),t&&U(e,t),e}var V=function(){return typeof Symbol=="function"},D=function(e){return V()&&Boolean(Symbol[e])},N=function(e){return D(e)?Symbol[e]:"@@"+e};V()&&!D("observable")&&(Symbol.observable=Symbol("observable"));var le=N("iterator"),C=N("observable"),j=N("species");function S(e,n){var t=e[n];if(t!=null){if(typeof t!="function")throw new TypeError(t+" is not a function");return t}}function y(e){var n=e.constructor;return n!==void 0&&(n=n[j],n===null&&(n=void 0)),n!==void 0?n:g}function ue(e){return e instanceof g}function v(e){v.log?v.log(e):setTimeout(function(){throw e})}function L(e){Promise.resolve().then(function(){try{e()}catch(n){v(n)}})}function K(e){var n=e._cleanup;if(n!==void 0&&(e._cleanup=void 0,!!n))try{if(typeof n=="function")n();else{var t=S(n,"unsubscribe");t&&t.call(n)}}catch(r){v(r)}}function M(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function ce(e){var n=e._queue;if(n){e._queue=void 0,e._state="ready";for(var t=0;t<n.length&&(z(e,n[t].type,n[t].value),e._state!=="closed");++t);}}function z(e,n,t){e._state="running";var r=e._observer;try{var i=S(r,n);switch(n){case"next":i&&i.call(r,t);break;case"error":if(M(e),i)i.call(r,t);else throw t;break;case"complete":M(e),i&&i.call(r);break}}catch(o){v(o)}e._state==="closed"?K(e):e._state==="running"&&(e._state="ready")}function A(e,n,t){if(e._state!=="closed"){if(e._state==="buffering"){e._queue.push({type:n,value:t});return}if(e._state!=="ready"){e._state="buffering",e._queue=[{type:n,value:t}],L(function(){return ce(e)});return}z(e,n,t)}}var fe=function(){function e(t,r){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var i=new de(this);try{this._cleanup=r.call(void 0,i)}catch(o){i.error(o)}this._state==="initializing"&&(this._state="ready")}var n=e.prototype;return n.unsubscribe=function(){this._state!=="closed"&&(M(this),K(this))},W(e,[{key:"closed",get:function(){return this._state==="closed"}}]),e}(),de=function(){function e(t){this._subscription=t}var n=e.prototype;return n.next=function(r){A(this._subscription,"next",r)},n.error=function(r){A(this._subscription,"error",r)},n.complete=function(){A(this._subscription,"complete")},W(e,[{key:"closed",get:function(){return this._subscription._state==="closed"}}]),e}(),g=function(){function e(t){if(!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}var n=e.prototype;return n.subscribe=function(r){return(typeof r!="object"||r===null)&&(r={next:r,error:arguments[1],complete:arguments[2]}),new fe(r,this._subscriber)},n.forEach=function(r){var i=this;return new Promise(function(o,a){if(typeof r!="function"){a(new TypeError(r+" is not a function"));return}function s(){l.unsubscribe(),o()}var l=i.subscribe({next:function(c){try{r(c,s)}catch(u){a(u),l.unsubscribe()}},error:a,complete:o})})},n.map=function(r){var i=this;if(typeof r!="function")throw new TypeError(r+" is not a function");var o=y(this);return new o(function(a){return i.subscribe({next:function(s){try{s=r(s)}catch(l){return a.error(l)}a.next(s)},error:function(s){a.error(s)},complete:function(){a.complete()}})})},n.filter=function(r){var i=this;if(typeof r!="function")throw new TypeError(r+" is not a function");var o=y(this);return new o(function(a){return i.subscribe({next:function(s){try{if(!r(s))return}catch(l){return a.error(l)}a.next(s)},error:function(s){a.error(s)},complete:function(){a.complete()}})})},n.reduce=function(r){var i=this;if(typeof r!="function")throw new TypeError(r+" is not a function");var o=y(this),a=arguments.length>1,s=!1,l=arguments[1],c=l;return new o(function(u){return i.subscribe({next:function(d){var f=!s;if(s=!0,!f||a)try{c=r(c,d)}catch(m){return u.error(m)}else c=d},error:function(d){u.error(d)},complete:function(){if(!s&&!a)return u.error(new TypeError("Cannot reduce an empty sequence"));u.next(c),u.complete()}})})},n.concat=function(){for(var r=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=y(this);return new s(function(l){var c,u=0;function d(f){c=f.subscribe({next:function(m){l.next(m)},error:function(m){l.error(m)},complete:function(){u===o.length?(c=void 0,l.complete()):d(s.from(o[u++]))}})}return d(r),function(){c&&(c.unsubscribe(),c=void 0)}})},n.flatMap=function(r){var i=this;if(typeof r!="function")throw new TypeError(r+" is not a function");var o=y(this);return new o(function(a){var s=[],l=i.subscribe({next:function(u){if(r)try{u=r(u)}catch(f){return a.error(f)}var d=o.from(u).subscribe({next:function(f){a.next(f)},error:function(f){a.error(f)},complete:function(){var f=s.indexOf(d);f>=0&&s.splice(f,1),c()}});s.push(d)},error:function(u){a.error(u)},complete:function(){c()}});function c(){l.closed&&s.length===0&&a.complete()}return function(){s.forEach(function(u){return u.unsubscribe()}),l.unsubscribe()}})},n[C]=function(){return this},e.from=function(r){var i=typeof this=="function"?this:e;if(r==null)throw new TypeError(r+" is not an object");var o=S(r,C);if(o){var a=o.call(r);if(Object(a)!==a)throw new TypeError(a+" is not an object");return ue(a)&&a.constructor===i?a:new i(function(s){return a.subscribe(s)})}if(D("iterator")&&(o=S(r,le),o))return new i(function(s){L(function(){if(!s.closed){for(var l=se(o.call(r)),c;!(c=l()).done;){var u=c.value;if(s.next(u),s.closed)return}s.complete()}})});if(Array.isArray(r))return new i(function(s){L(function(){if(!s.closed){for(var l=0;l<r.length;++l)if(s.next(r[l]),s.closed)return;s.complete()}})});throw new TypeError(r+" is not observable")},e.of=function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=typeof this=="function"?this:e;return new a(function(s){L(function(){if(!s.closed){for(var l=0;l<i.length;++l)if(s.next(i[l]),s.closed)return;s.complete()}})})},W(e,null,[{key:j,get:function(){return this}}]),e}();V()&&Object.defineProperty(g,Symbol("extensions"),{value:{symbol:C,hostReportError:v},configurable:!0});function E(e){let n=e.vault.getAllFolders();return{raw:n,asPathes:n.map(t=>t.path)}}function h(e){let n=e.trim();return n.substring(0,n.length-1)}function G(e,n){return new g(t=>{let r=null,i=e.subscribe({next(o){r&&clearTimeout(r),r=setTimeout(()=>{t.next(o)},n)},error(o){t.error(o)},complete(){t.complete()}});return()=>{r&&clearTimeout(r),i.unsubscribe()}})}function H(e){if(this.app.workspace.getLeavesOfType(e).length!==1)throw new Error(`Could not load core plugin of type ${e}.`);return this.app.workspace.getLeavesOfType(e)[0]}var p=class extends $.MarkdownRenderChild{constructor(t,r,i){super(t);this.targets=r;!p.filesCorePlugin&&i&&(p.filesCorePlugin=i)}onload(){this.render()}render(){this.targets.forEach(t=>{if(!t.dataset.href||!p.folders)return;let r=h(t.dataset.href);t.dataset.folderLink=t.dataset.href,p.folders.asPathes.includes(r)?(t.addClass(T),t.removeClass(_),t.removeAttribute("data-href"),t.removeAttribute("href"),t.removeAttribute("target")):(t.addClass(_),t.removeClass(T))})}};var q=class{constructor(n,t){this.folderObs=n;this.filesCorePlugin=t;this.folderLinkViews=[];this.folderObs.subscribe(r=>{p.folders=r,this.folderLinkViews.forEach(i=>{i.render()})})}create(){return(n,t)=>{let r=n.findAll(".internal-link").filter(i=>i.dataset.href&&i.dataset.href.endsWith("/"));if(r&&r.length){let i=new p(n,r,this.filesCorePlugin);t.addChild(i),this.folderLinkViews.push(i)}}}},J=(e,n)=>new q(e,n).create();var k=require("@codemirror/state"),R=k.StateEffect.define(),pe=k.StateEffect.define(),b=k.StateField.define({create(e){return{raw:[],asPathes:[]}},update(e,n){let t=e;for(let r of n.effects)r.is(R)?t=r.value:r.is(pe)&&(t={raw:[],asPathes:[]});return t}});var O=require("@codemirror/view"),Q=require("@codemirror/state"),X=require("@codemirror/language");var Y=O.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged||e.state.field(b)!==e.startState.field(b))&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){let n=new Q.RangeSetBuilder,t=e.state.field(b),r=null,i=null,o=!1;for(let{from:a,to:s}of e.visibleRanges)(0,X.syntaxTree)(e.state).iterate({from:a,to:s,enter(l){let c=l.type.name.includes("hmd-internal-link");if(!r&&!i&&c)r=l.from,i=l.to,o=l.type.name.includes("link-has-alias");else if(r&&c)i=l.to;else if(r&&i&&!c){let u=e.state.doc.sliceString(r,i),d=u;if(o){let f=u.split("|");d=f[0],u=f[1]}if(d.trim().endsWith("/")){let f=h(d.trim()),m=t.asPathes.includes(f)?"is-resolved":"is-unresolved";n.add(r,i,O.Decoration.mark({class:m+" folder-link",attributes:{"data-folder-link":d}}))}r=null,i=null,o=!1}}});return n.finish()}},{decorations:e=>e.decorations});var x=require("obsidian"),F=class extends x.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;t.empty(),new x.Setting(t).setName("Show Folder Links in Outgoing Links Tab").addToggle(r=>r.setValue(this.plugin.settings.showInBackLinks).onChange(async i=>{this.plugin.settings.showInBackLinks=i,await this.plugin.saveSettings()}))}};var Z={showInBackLinks:!0};var P=class extends w.Plugin{constructor(){super(...arguments);this.outgoingLinkMutationHandler=(t,r)=>{for(let i of t)i.addedNodes.length>0&&(this.settings.showInBackLinks?Array.from(i.addedNodes).every(o=>o instanceof HTMLElement&&!o.className.contains("lucide")&&!o.dataset.lucide)&&this.updateFolderLinksFromOutgoingLinks():this.removeFolderLinksFromOutgoingLinks())}}on(t,r,i,o,a){this.registerDomEvent(t,r,s=>{let l=s.target.closest(i);l&&o(l,s)},a)}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}removeFolderLinksFromOutgoingLinks(){this.outgoingLinkPlugin.view.containerEl.querySelectorAll(".outgoing-link-item").forEach(r=>{var i;(i=r.textContent)!=null&&i.endsWith("/")&&r.remove()})}updateFolderLinksFromOutgoingLinks(){this.outgoingLinkPlugin.view.containerEl.querySelectorAll(".outgoing-link-item").forEach(r=>{let i=r.textContent;if(i!=null&&i.endsWith("/")&&this.currentFolderObsValue){let o=this.currentFolderObsValue.raw.filter(s=>s.path===h(i))[0];r.dataset.folderLink=i;let a=r.querySelector(".tree-item-icon");o?(r.ariaLabel=window.OBSIDIAN_DEFAULT_I18N.plugins.fileExplorer.actionRevealFile,a&&(0,w.setIcon)(a,"link")):(r.ariaLabel=window.OBSIDIAN_DEFAULT_I18N.plugins.outgoingLinks.tooltipNotCreated,a&&(0,w.setIcon)(a,"folder-plus"))}})}setupOutgoingLinksPaneObserver(){this.workspaceObserver=new MutationObserver((r,i)=>{let o=this.app.workspace.containerEl.querySelector(".outgoing-link-pane");o&&(this.mutationObserver.observe(o,{subtree:!0,childList:!0}),i.disconnect())}),this.workspaceObserver.observe(this.app.workspace.containerEl,{subtree:!0,childList:!0});let t=this.app.workspace.containerEl.querySelector(".outgoing-link-pane");t&&this.mutationObserver.observe(t,{subtree:!0,childList:!0})}updateEditorState(t){var o;let r=this.app.workspace.getActiveViewOfType(w.MarkdownView);if(!r)return;let i=r.editor.cm;if(i.dispatch({effects:[R.of(t)]}),i.hasFocus&&((o=i.state)==null?void 0:o.field(b))==null)throw new Error("could not update editor state")}setupClickListener(){this.on(window,"click","[data-folder-link]",(t,r)=>{r.stopPropagation();let i=this.currentFolderObsValue.raw.filter(o=>o.path===h(t.dataset.folderLink))[0];i?this.fileExplorerPlugin.view.revealInFolder(i):this.app.vault.createFolder(h(t.dataset.folderLink))},!0)}async onload(){if(await this.loadSettings(),this.addSettingTab(new F(this.app,this)),!window.OBSIDIAN_DEFAULT_I18N)throw new Error("could not load obsdidian default i18n");this.setupClickListener(),this.app.workspace.onLayoutReady(()=>{this.fileExplorerPlugin=H("file-explorer"),this.outgoingLinkPlugin=H("outgoing-link"),this.mutationObserver=new MutationObserver(this.outgoingLinkMutationHandler),this.setupOutgoingLinksPaneObserver(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateEditorState(this.currentFolderObsValue)})),this.folderObservable=G(new g(t=>{t.next(E(this.app)),this.registerEvent(this.app.vault.on("create",()=>{t.next(E(this.app))})),this.registerEvent(this.app.vault.on("rename",()=>{t.next(E(this.app))})),this.registerEvent(this.app.vault.on("delete",()=>{t.next(E(this.app))}))}),50),this.init()})}init(){this.folderObservable.subscribe(t=>{this.currentFolderObsValue=t,this.updateEditorState(t),this.settings.showInBackLinks?this.updateFolderLinksFromOutgoingLinks():this.removeFolderLinksFromOutgoingLinks()}),this.registerMarkdownPostProcessor(J(this.folderObservable,this.fileExplorerPlugin)),this.registerEditorExtension([b,Y])}unload(){var t,r;(t=this.mutationObserver)==null||t.disconnect(),(r=this.workspaceObserver)==null||r.disconnect(),super.unload()}};

/* nosourcemap */